<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gestión de Propinas Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #070b14; color: #f1f5f9; }
        .card-empleado { background: #111827; border: 1px solid #1e293b; transition: all 0.2s; }
        .card-empleado.selected { border-color: #3b82f6; background: #1e293b; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-md mx-auto space-y-6">
        <header class="text-center">
            <h1 class="text-3xl font-black italic">SANTINI</h1>
            <p class="text-sky-400 text-xs font-bold tracking-widest uppercase">Sistema de Propinas</p>
        </header>

        <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800 shadow-xl">
            <label class="block text-sky-400 text-[10px] font-black uppercase mb-2">Total Propinas del Turno</label>
            <input type="number" id="monto-total" placeholder="0.00" oninput="calcular()" 
                class="w-full bg-transparent text-4xl font-black outline-none border-b-2 border-slate-700 focus:border-sky-500 transition-colors">
        </div>

        <div class="space-y-3">
            <h2 class="text-xs font-black uppercase text-slate-500 px-2">Personal en Turno (Toca para activar y poner horas)</h2>
            <div id="lista-personal" class="grid grid-cols-2 gap-2">
                </div>
        </div>

        <div class="bg-white text-slate-900 rounded-3xl p-6 shadow-2xl">
            <h3 class="text-[10px] font-black uppercase mb-4 text-slate-400">Distribución por Horas</h3>
            <div id="tabla-resultados" class="space-y-4">
                </div>
            <hr class="my-4 border-slate-100">
            <div class="flex justify-between items-center font-black">
                <span class="text-xs uppercase">Total a Repartir:</span>
                <span id="display-total" class="text-2xl text-sky-600">$ 0</span>
            </div>
        </div>

        <button onclick="generarReporte()" class="w-full bg-sky-500 text-slate-900 p-4 rounded-2xl font-black uppercase shadow-lg active:scale-95 transition-transform">
            Generar Reporte y Limpiar
        </button>
    </div>

    <script>
        // LISTADO DE PERSONAL - Podés agregar o quitar acá
        const staff = ["MARIA", "ANA", "CARLOS", "JUAN", "BELEN", "ZULMA", "DANIEL", "ROSA"];
        
        let seleccionados = [];

        function renderizarPersonal() {
            const container = document.getElementById('lista-personal');
            container.innerHTML = "";
            
            // 1. ORDENAR ALFABÉTICAMENTE
            staff.sort().forEach(nombre => {
                const isSel = seleccionados.find(s => s.nombre === nombre);
                container.innerHTML += `
                    <button onclick="toggleEmpleado('${nombre}')" 
                        class="card-empleado p-4 rounded-2xl text-left font-bold ${isSel ? 'selected ring-2 ring-sky-500' : 'opacity-50'}">
                        <div class="text-xs text-slate-500 font-black">${nombre}</div>
                        <div class="text-sm ${isSel ? 'text-sky-400' : 'text-white'}">${isSel ? isSel.horas + ' hs' : 'Inactivo'}</div>
                    </button>
                `;
            });
        }

        function toggleEmpleado(nombre) {
            const index = seleccionados.findIndex(s => s.nombre === nombre);
            
            if (index > -1) {
                // Si ya está, lo sacamos
                seleccionados.splice(index, 1);
            } else {
                // Si no está, preguntamos las horas
                const horas = prompt(`¿Cuántas horas trabajó ${nombre}?`, "8");
                if (horas !== null && horas > 0) {
                    seleccionados.push({ nombre: nombre, horas: parseFloat(horas) });
                }
            }
            
            // 2. RE-ORDENAR SELECCIONADOS ALFABÉTICAMENTE para la tabla
            seleccionados.sort((a, b) => a.nombre.localeCompare(b.nombre));
            
            renderizarPersonal();
            calcular();
        }

        function calcular() {
            const total = parseFloat(document.getElementById('monto-total').value) || 0;
            const resContainer = document.getElementById('tabla-resultados');
            const totalHoras = seleccionados.reduce((sum, s) => sum + s.horas, 0);
            
            document.getElementById('display-total').innerText = `$ ${total.toLocaleString()}`;
            resContainer.innerHTML = "";

            if (seleccionados.length === 0 || total === 0) {
                resContainer.innerHTML = `<p class="text-slate-400 text-center py-4 font-bold italic">Esperando datos...</p>`;
                return;
            }

            const valorHora = total / totalHoras;

            seleccionados.forEach(emp => {
                const pago = emp.horas * valorHora;
                resContainer.innerHTML += `
                    <div class="flex justify-between items-center border-b border-slate-50 pb-2">
                        <div>
                            <div class="font-black text-slate-800">${emp.nombre}</div>
                            <div class="text-[9px] text-slate-400 uppercase font-bold">${emp.horas} horas trabajadas</div>
                        </div>
                        <div class="text-lg font-black text-sky-600">$ ${pago.toFixed(2)}</div>
                    </div>
                `;
            });
        }

        function generarReporte() {
            if (seleccionados.length === 0) return alert("No hay personal seleccionado");
            
            const total = document.getElementById('monto-total').value;
            const ahora = new Date().toLocaleString('es-AR');
            
            let txt = `REPORTE DE PROPINAS - SANTINI\n`;
            txt += `Fecha: ${ahora}\n`;
            txt += `Monto Total: $${total}\n`;
            txt += `--------------------------------\n`;
            
            seleccionados.forEach(emp => {
                const valorHora = total / seleccionados.reduce((sum, s) => sum + s.horas, 0);
                txt += `${emp.nombre} | ${emp.horas}hs | Recibe: $${(emp.horas * valorHora).toFixed(2)}\n`;
            });

            const blob = new Blob([txt], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Propinas_${ahora.split(',')[0].replace(/\//g, '-')}.txt`;
            link.click();

            // Limpiar todo
            seleccionados = [];
            document.getElementById('monto-total').value = "";
            renderizarPersonal();
            calcular();
        }

        // Inicio
        renderizarPersonal();
    </script>
</body>
</html>
