<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<title>DAS-Agenda</title>
<script src=""></script>
<style>
.hidden { display: none; }
.active { background: #2563eb !important; color: white !important; }
</style>
</head>
<body class="bg-gray-100">

<div id="login-screen" class="p-20 text-center">
<h1 class="text-4xl font-bold mb-10">DAS-Agenda</h1>
<input type="email" id="email" placeholder="Email" class="border p-4 mb-4 w-64 block mx-auto rounded">
<input type="password" id="password" placeholder="Pass" class="border p-4 mb-4 w-64 block mx-auto rounded">
<button onclick="handleAuth('login')" class="bg-blue-600 text-white p-4 w-64 rounded font-bold">ENTRAR</button>
</div>

<div id="agenda-screen" class="hidden">
<nav class="bg-white p-4 shadow flex justify-between items-center">
<b class="text-blue-600">DAS-PRO</b>
<div class="flex gap-2">
<button id="bt1" onclick="showS('tasks')" class="active p-2 rounded text-xs">TAREAS</button>
<button id="bt2" onclick="showS('tips')" class="p-2 rounded text-xs bg-gray-200">PROPINAS</button>
</div>
<button onclick="logout()">Salir</button>
</nav>

<div id="section-tasks" class="p-10 max-w-xl mx-auto">
<input type="text" id="t-in" class="border p-4 w-full rounded mb-4" placeholder="Nueva tarea...">
<button onclick="saveT()" class="bg-blue-600 text-white p-4 w-full rounded">GUARDAR</button>
<ul id="t-list" class="mt-10 bg-white shadow rounded"></ul>
</div>

<div id="section-tips" class="hidden p-10 max-w-4xl mx-auto">
<div class="bg-white p-6 rounded shadow mb-6">
<h2 class="font-bold mb-4">Calculadora de Propinas</h2>
<input type="number" id="tip-total" oninput="calc()" class="border-2 border-blue-200 p-4 text-2xl w-full rounded" placeholder="Monto Total $">
</div>
<div class="grid grid-cols-2 gap-4">
<div class="bg-white p-4 rounded shadow">
<input type="text" id="st-name" class="border p-2 w-full rounded mb-2" placeholder="Nuevo empleado">
<button onclick="addSt()" class="bg-black text-white p-2 w-full rounded">Agregar Staff</button>
<ul id="st-list" class="mt-4"></ul>
</div>
<div class="bg-white p-4 rounded shadow text-center">
<p class="text-xs text-gray-400">VALOR HORA</p>
<h3 id="vh" class="text-3xl font-bold text-blue-600">$0.00</h3>
</div>
</div>
<table class="w-full mt-10 bg-white rounded shadow">
<thead><tr class="border-b"><th>Nombre</th><th>Horas</th><th>Total</th></tr></thead>
<tbody id="dist-body"></tbody>
</table>
</div>
</div>

<script type="module">
import { initializeApp } from "";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "";
import { getFirestore, collection, addDoc, query, where, onSnapshot, doc, deleteDoc } from "";

const config = {
apiKey: "AIzaSyAffYd8QzcABt6bktN4xSw-XtK1jwJgYQI",
authDomain: "das-agenda.firebaseapp.com",
projectId: "das-agenda",
storageBucket: "das-agenda.firebasestorage.app",
messagingSenderId: "995103851313",
appId: "1:995103851313:web:39a19797ab209439fde610"
};

const app = initializeApp(config);
const auth = getAuth(app);
const db = getFirestore(app);
let staff = []; let uid = null;

window.showS = (s) => {
document.getElementById('section-tasks').classList.toggle('hidden', s !== 'tasks');
document.getElementById('section-tips').classList.toggle('hidden', s !== 'tips');
document.getElementById('bt1').classList.toggle('active', s === 'tasks');
document.getElementById('bt2').classList.toggle('active', s === 'tips');
};

window.handleAuth = async (t) => {
const e = document.getElementById('email').value;
const p = document.getElementById('password').value;
try { await signInWithEmailAndPassword(auth, e, p); } catch (err) { alert(err.message); }
};

window.logout = () => signOut(auth);

onAuthStateChanged(auth, (user) => {
if (user) {
uid = user.uid;
document.getElementById('login-screen').classList.add('hidden');
document.getElementById('agenda-screen').classList.remove('hidden');
onSnapshot(query(collection(db, "tasks"), where("userId", "==", uid)), (s) => {
document.getElementById('t-list').innerHTML = s.docs.map(d => &lt;li class=&quot;p-4 border-b flex justify-between&quot;&gt;&lt;span&gt;${d.data().detail}&lt;/span&gt;&lt;button onclick=&quot;delT(&#39;${d.id}&#39;)&quot;&gt;X&lt;/button&gt;&lt;/li&gt;).join('');
});
onSnapshot(query(collection(db, "staff"), where("userId", "==", uid)), (s) => {
staff = s.docs.map(d => ({id: d.id, ...d.data()}));
document.getElementById('st-list').innerHTML = staff.map(s => &lt;li class=&quot;flex justify-between p-1&quot;&gt;&lt;span&gt;${s.name}&lt;/span&gt;&lt;button onclick=&quot;delSt(&#39;${s.id}&#39;)&quot;&gt;Ã—&lt;/button&gt;&lt;/li&gt;).join('');
document.getElementById('dist-body').innerHTML = staff.map(s => &lt;tr&gt;&lt;td class=&quot;p-4&quot;&gt;${s.name}&lt;/td&gt;&lt;td class=&quot;text-center&quot;&gt;&lt;input type=&quot;number&quot; oninput=&quot;calc()&quot; class=&quot;h-in border w-16 text-center&quot; data-id=&quot;${s.id}&quot;&gt;&lt;/td&gt;&lt;td class=&quot;text-right p-4 font-bold&quot; id=&quot;res-${s.id}&quot;&gt;$0.00&lt;/td&gt;&lt;/tr&gt;).join('');
});
}
});

window.saveT = async () => { const v = document.getElementById('t-in').value; if(v) await addDoc(collection(db, "tasks"), { detail: v, userId: uid }); document.getElementById('t-in').value = ''; };
window.delT = async (id) => await deleteDoc(doc(db, "tasks", id));
window.addSt = async () => { const v = document.getElementById('st-name').value; if(v) await addDoc(collection(db, "staff"), { name: v, userId: uid }); document.getElementById('st-name').value = ''; };
window.delSt = async (id) => await deleteDoc(doc(db, "staff", id));

window.calc = () => {
const tot = parseFloat(document.getElementById('tip-total').value) || 0;
const ins = document.querySelectorAll('.h-in');
let hS = 0; ins.forEach(i => hS += parseFloat(i.value) || 0);
const vh = hS > 0 ? tot / hS : 0;
document.getElementById('vh').innerText = $${vh.toFixed(2)};
ins.forEach(i => {
const id = i.getAttribute('data-id');
document.getElementById(res-${id}).innerText = $${((parseFloat(i.value) || 0) * vh).toFixed(2)};
});
};
</script>

</body>
</html>
